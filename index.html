<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>好保研 Unipath - 智能保研规划系统</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        unipath: {
                            50: '#f3f1f8',
                            100: '#e5e0f0',
                            200: '#d0c3e3',
                            300: '#b39cd0',
                            400: '#9470b9',
                            500: '#7b4fa3', 
                            600: '#643a85',
                            700: '#532f6d',
                            800: '#46285a',
                            900: '#3b234a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .glass-nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #7b4fa3;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "jszip": "https://esm.sh/jszip@^3.10.1",
    "pptxgenjs": "https://esm.sh/pptxgenjs@^4.0.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="min-h-screen flex flex-col text-slate-800 bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 selection:bg-unipath-200">

    <!-- Header -->
    <header class="glass-nav sticky top-0 z-40 border-b border-white/50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4 cursor-pointer group" onclick="resetApp()">
                <div class="flex items-center gap-2">
                    <div class="bg-gradient-to-br from-unipath-600 to-unipath-500 text-white px-3 py-1.5 font-bold text-xl rounded-lg shadow-lg shadow-unipath-200 transform group-hover:scale-105 transition-transform duration-300">
                        Unipath
                    </div>
                    <div class="flex flex-col">
                         <span class="text-slate-900 font-bold leading-tight">好保研</span>
                         <span class="text-[10px] text-slate-500 font-medium tracking-widest uppercase">Smart Planner</span>
                    </div>
                </div>
            </div>
            
            <nav class="flex items-center gap-1 sm:gap-2">
                <button onclick="resetApp()" class="px-4 py-2 rounded-lg text-sm font-semibold text-slate-500 hover:text-slate-800 transition-all">首页</button>
                <button onclick="showProductModal('SUNRISE')" class="px-4 py-2 rounded-lg text-sm font-semibold text-slate-600 hover:text-unipath-600 hover:bg-unipath-50 transition-all">破晓计划</button>
                <button onclick="showProductModal('HARVEST')" class="px-4 py-2 rounded-lg text-sm font-semibold text-slate-600 hover:text-unipath-600 hover:bg-unipath-50 transition-all">桃李计划</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow">
        <div class="max-w-6xl mx-auto px-4 py-8 md:py-16">
            
            <!-- Hero Section -->
            <div id="heroSection" class="text-center mb-16 animate-fade-in-up">
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/60 border border-white/50 shadow-sm text-unipath-600 text-sm font-medium mb-6 backdrop-blur-sm">
                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                    <span>专注新工科保研 · 深度规划 · 锁定名校</span>
                </div>
                <h1 class="text-5xl md:text-7xl font-extrabold text-slate-900 mb-6 tracking-tight leading-tight">
                    <span class="bg-clip-text text-transparent bg-gradient-to-r from-unipath-700 via-purple-600 to-pink-600">好保研，保好研</span>
                </h1>
                <p class="text-xl md:text-2xl text-slate-600 max-w-2xl mx-auto font-light leading-relaxed">
                    基于 <span class="font-semibold text-slate-800">DeepSeek</span> 大模型与十年保研数据沉淀，
                    <br class="hidden md:block" />
                    为你生成一份价值百万的升学规划方案。
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                
                <!-- Input Form (Left Column) -->
                <div id="formContainer" class="lg:col-start-3 lg:col-span-8 transition-all duration-500">
                    <div class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl shadow-slate-200/50 border border-white p-6 md:p-8 relative overflow-hidden">
                        <!-- Decorative BG -->
                        <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-unipath-100/50 to-transparent rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>

                        <div class="flex items-center gap-3 mb-8 text-slate-800 relative z-10">
                            <div class="p-2 bg-unipath-50 rounded-lg text-unipath-600">
                                <i data-lucide="book-open" class="w-6 h-6"></i>
                            </div>
                            <h2 class="text-2xl font-bold">个人学术画像</h2>
                        </div>
                        
                        <form id="baoyanForm" class="space-y-5 relative z-10">
                            <div class="grid grid-cols-2 gap-5">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">姓名</label>
                                    <input type="text" id="name" required class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all font-medium" placeholder="你的名字">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">年级</label>
                                    <div class="relative">
                                        <select id="grade" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all appearance-none font-medium text-slate-700">
                                            <option value="大一">大一</option>
                                            <option value="大二" selected>大二</option>
                                            <option value="大三">大三</option>
                                            <option value="大四">大四</option>
                                        </select>
                                        <i data-lucide="chevron-right" class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 rotate-90 pointer-events-none"></i>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">就读院校</label>
                                <input type="text" id="university" required class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all font-medium" placeholder="例如：上海交通大学">
                            </div>

                            <div class="grid grid-cols-2 gap-5">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">专业</label>
                                    <input type="text" id="major" required class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all font-medium" placeholder="例如：计算机科学">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">排名/绩点</label>
                                    <input type="text" id="rank" required class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all font-medium" placeholder="Top 5% 或 3.8/4.0">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">英语水平</label>
                                <input type="text" id="englishLevel" required class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all font-medium" placeholder="例如：CET6 580">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">竞赛奖项</label>
                                <textarea id="awards" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all font-medium h-24 text-sm resize-none" placeholder="简述主要奖项，如：数模国二、互联网+银奖..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">科研/论文</label>
                                <textarea id="research" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all font-medium h-24 text-sm resize-none" placeholder="简述科研经历，如：发表一篇SCI三区一作..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">意向保研方向</label>
                                <input type="text" id="targetDirection" required class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-unipath-500/20 focus:border-unipath-500 transition-all font-medium" placeholder="例如：人工智能、金融科技">
                            </div>

                            <div class="group flex items-center gap-3 bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-100 hover:border-blue-200 transition-colors cursor-pointer" onclick="toggleNewEngineering()">
                                <div id="newEngCheckbox" class="w-5 h-5 rounded border border-slate-300 bg-white flex items-center justify-center transition-colors">
                                    <i data-lucide="check" class="w-3.5 h-3.5 text-white hidden"></i>
                                </div>
                                <input type="checkbox" id="isNewEngineering" class="hidden">
                                <div>
                                    <div class="text-sm font-semibold text-slate-800">属于新工科方向</div>
                                    <div class="text-xs text-slate-500">CS/AI/电子/通信等 (匹配破晓计划)</div>
                                </div>
                            </div>

                            <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-unipath-600 to-purple-600 hover:from-unipath-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-unipath-500/30 transform transition-all hover:-translate-y-1 hover:shadow-xl flex items-center justify-center gap-2 group">
                                <span id="btnIcon"><i data-lucide="sparkles" class="w-5 h-5 group-hover:animate-pulse"></i></span>
                                <span id="btnLoader" class="loader hidden"></span>
                                <span id="btnText">立即生成规划方案</span>
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Result Display (Right Column - Initially Hidden) -->
                <div id="resultContainer" class="lg:col-span-8 space-y-6 pb-12 hidden animate-fade-in-up">
                    
                    <!-- Summary Card -->
                    <div class="bg-slate-900 text-white rounded-2xl shadow-xl p-6 flex justify-between items-center gap-4">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-white/10 rounded-lg">
                                <i data-lucide="trending-up" class="w-6 h-6 text-emerald-400"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg">保研成功率预估</h3>
                                <p class="text-slate-400 text-sm">基于数万条历史数据匹配</p>
                            </div>
                        </div>
                    </div>

                    <!-- SWOT Section -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                        <h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center gap-2">
                            <span class="w-1.5 h-6 bg-slate-800 rounded-full"></span>
                            SWOT 核心竞争力分析
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="swotGrid">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Analysis Card -->
                    <div class="bg-white/90 backdrop-blur rounded-2xl shadow-sm border border-slate-100 p-8 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                        <div class="flex items-center gap-3 mb-4">
                            <i data-lucide="file-text" class="w-6 h-6 text-blue-500"></i>
                            <h3 id="analysisTitle" class="text-xl font-bold text-slate-900">背景深度诊断</h3>
                        </div>
                        <div id="analysisSummary" class="text-slate-700 leading-relaxed text-lg bg-slate-50 p-6 rounded-xl border border-slate-100 italic"></div>
                        <div id="analysisContent" class="mt-6 space-y-2"></div>
                    </div>

                    <!-- Three Pillars: Schools, Competitions, Research -->
                    <div class="grid grid-cols-1 gap-6">
                        <!-- Schools -->
                        <div class="bg-gradient-to-br from-indigo-50 to-white rounded-2xl shadow-sm border border-indigo-100 p-6 relative overflow-hidden">
                            <div class="flex items-center gap-3 mb-6 relative z-10">
                                <div class="p-2 bg-indigo-100 text-indigo-600 rounded-lg"><i data-lucide="target" class="w-6 h-6"></i></div>
                                <h3 id="schoolsTitle" class="text-xl font-bold text-slate-900">目标院校</h3>
                            </div>
                            <div id="schoolsContent" class="grid gap-3 relative z-10"></div>
                        </div>

                        <!-- Competitions -->
                        <div class="bg-gradient-to-br from-amber-50 to-white rounded-2xl shadow-sm border border-amber-100 p-6 relative overflow-hidden">
                            <div class="flex items-center gap-3 mb-6 relative z-10">
                                <div class="p-2 bg-amber-100 text-amber-600 rounded-lg"><i data-lucide="award" class="w-6 h-6"></i></div>
                                <h3 id="compsTitle" class="text-xl font-bold text-slate-900">竞赛规划</h3>
                            </div>
                            <div id="compsContent" class="space-y-3 relative z-10"></div>
                        </div>

                        <!-- Research -->
                        <div class="bg-gradient-to-br from-cyan-50 to-white rounded-2xl shadow-sm border border-cyan-100 p-6 relative overflow-hidden">
                            <div class="flex items-center gap-3 mb-6 relative z-10">
                                <div class="p-2 bg-cyan-100 text-cyan-600 rounded-lg"><i data-lucide="book-open" class="w-6 h-6"></i></div>
                                <h3 id="researchTitle" class="text-xl font-bold text-slate-900">科研规划</h3>
                            </div>
                            <div id="researchContent" class="space-y-3 relative z-10"></div>
                        </div>
                    </div>

                    <!-- Career Section -->
                    <div id="careerSection" class="bg-gradient-to-r from-slate-900 to-slate-800 rounded-2xl shadow-xl p-8 text-white relative overflow-hidden">
                        <!-- Populated by JS -->
                    </div>

                    <!-- Timeline -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-8">
                        <h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                            <div class="p-2 bg-slate-100 rounded-lg text-slate-600"><i data-lucide="arrow-right" class="w-5 h-5"></i></div>
                            <span id="timelineTitle">关键时间节点</span>
                        </h3>
                        <div id="timelineContent" class="space-y-0 relative">
                            <div class="absolute left-[19px] top-4 bottom-4 w-0.5 bg-slate-100"></div>
                        </div>
                    </div>

                    <!-- Product Recommendation -->
                    <div id="productCard" class="rounded-2xl shadow-xl p-8 text-white bg-gradient-to-br relative overflow-hidden">
                        <!-- Populated by JS -->
                    </div>

                </div>
            </div>
        </div>
    </main>

    <footer class="bg-slate-900 text-slate-400 py-12 border-t border-slate-800">
        <div class="max-w-6xl mx-auto px-4 text-center">
             <div class="flex items-center justify-center gap-2 mb-6 opacity-50">
                <div class="font-bold text-2xl tracking-tight text-slate-200">Unipath</div>
            </div>
            <p class="mb-4 text-slate-500">© 2024 好保研 Unipath. All rights reserved.</p>
            <p class="text-xs text-slate-600 max-w-lg mx-auto leading-relaxed">数据来源：教育部官方平台及各高校研究生院官网。AI生成内容仅供参考。本产品规划方案基于深度学习模型生成，不代表最终录取结果。</p>
        </div>
    </footer>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeProductModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl relative z-10 overflow-hidden animate-fade-in-up flex flex-col max-h-[90vh]">
            <div id="modalHeader" class="p-8 text-white bg-gradient-to-br relative">
                <button onclick="closeProductModal()" class="absolute top-4 right-4 text-white/70 hover:text-white transition bg-black/10 hover:bg-black/20 rounded-full p-1">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
                <div class="flex items-center gap-3 mb-3">
                    <div class="bg-white/20 p-2 rounded-lg backdrop-blur-md">
                        <i id="modalIcon" data-lucide="zap" class="w-6 h-6"></i>
                    </div>
                    <h3 id="modalTitle" class="text-2xl font-bold tracking-tight"></h3>
                </div>
                <p id="modalTagline" class="text-white/90 font-medium text-lg"></p>
            </div>
            <div class="p-8 space-y-6 overflow-y-auto">
                <div>
                    <h4 class="font-bold text-slate-900 mb-2 flex items-center gap-2">
                        <span class="w-1 h-4 bg-unipath-500 rounded-full"></span>项目介绍
                    </h4>
                    <p id="modalDesc" class="text-slate-600 leading-relaxed"></p>
                </div>
                <div class="space-y-4">
                    <h4 class="font-bold text-slate-900 mb-2 flex items-center gap-2">
                        <span class="w-1 h-4 bg-unipath-500 rounded-full"></span>核心权益
                    </h4>
                    <div id="modalFeatures" class="grid grid-cols-1 gap-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logic Script -->
    <script>
        // --- Constants ---
        const API_KEY = "sk-f2335a96cee0449386e3822542892783";
        const API_URL = "https://api.deepseek.com/chat/completions";

        const PRODUCTS = {
            SUNRISE: {
                name: "破晓计划 (Sunrise Project)",
                tagline: "新工科保研 · 顶刊顶会冲刺",
                description: "专为计算机、人工智能、电子信息等新工科专业打造。聚焦CCF-A/B类会议及SCI期刊科研产出，提供从课题选题、实验设计到论文发表的全流程学术指导，助力冲击清北华五。",
                color: "from-blue-600 to-purple-600",
                features: [
                    'CCF-A/B类会议 & SCI期刊论文指导',
                    '清华/北大/中科院夏令营入营辅导',
                    'ACM/ICPC 金牌导师竞赛护航',
                    '新工科（CS/AI）博士团 1v1 定制'
                ]
            },
            HARVEST: {
                name: "桃李计划 (Harvest Project)",
                tagline: "全学科保研 · 综合背景提升",
                description: "覆盖文理工商医全学科。依托十年保研大数据，提供个性化择校定位、文书深度润色及面试（单面/群面）实战演练，精准匹配10000+名校导师资源。",
                color: "from-purple-600 to-pink-600",
                features: [
                    '全学科 10000+ 导师数据库精准匹配',
                    '个性化文书深度润色 (5轮+)',
                    '模拟面试 (单面/群面) 实战演练',
                    '跨专业保研特别辅导方案'
                ]
            }
        };

        // --- State ---
        let isNewEngineering = false;

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // Check for previous plan in LocalStorage
            const savedPlan = localStorage.getItem('unipath_plan');
            if (savedPlan) {
                // Optional: Automatically restore? For now let's keep it fresh interaction.
                // console.log("Found saved plan"); 
            }
        });

        // --- UI Interactions ---

        function toggleNewEngineering() {
            isNewEngineering = !isNewEngineering;
            const checkbox = document.getElementById('isNewEngineering');
            checkbox.checked = isNewEngineering;
            
            const visualBox = document.getElementById('newEngCheckbox');
            const icon = visualBox.querySelector('i'); // Get the lucide icon inside
            
            if (isNewEngineering) {
                visualBox.classList.remove('bg-white', 'border-slate-300');
                visualBox.classList.add('bg-blue-600', 'border-blue-600');
                // Since Lucide replaces <i> with <svg>, we need to target the svg
                const svg = visualBox.querySelector('svg');
                if(svg) svg.classList.remove('hidden');
            } else {
                visualBox.classList.add('bg-white', 'border-slate-300');
                visualBox.classList.remove('bg-blue-600', 'border-blue-600');
                const svg = visualBox.querySelector('svg');
                if(svg) svg.classList.add('hidden');
            }
        }

        function resetApp() {
            document.getElementById('formContainer').classList.remove('hidden', 'lg:col-span-4');
            document.getElementById('formContainer').classList.add('lg:col-start-3', 'lg:col-span-8');
            document.getElementById('resultContainer').classList.add('hidden');
            document.getElementById('heroSection').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function showProductModal(type) {
            const product = PRODUCTS[type];
            const modal = document.getElementById('productModal');
            const header = document.getElementById('modalHeader');
            
            header.className = `p-8 text-white bg-gradient-to-br ${product.color} relative`;
            document.getElementById('modalTitle').innerText = product.name;
            document.getElementById('modalTagline').innerText = product.tagline;
            document.getElementById('modalDesc').innerText = product.description;
            
            const featureContainer = document.getElementById('modalFeatures');
            featureContainer.innerHTML = product.features.map(f => `
                <div class="flex items-start gap-3 p-3 rounded-xl bg-slate-50 border border-slate-100">
                    <i data-lucide="check-circle" class="w-5 h-5 text-unipath-500 mt-0.5 flex-shrink-0"></i>
                    <span class="text-slate-700 text-sm font-medium">${f}</span>
                </div>
            `).join('');

            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.add('hidden');
        }

        // --- Form Submission & API Logic ---

        document.getElementById('baoyanForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // UI Loading State
            const btn = document.getElementById('submitBtn');
            const icon = document.getElementById('btnIcon');
            const loader = document.getElementById('btnLoader');
            const text = document.getElementById('btnText');
            
            btn.disabled = true;
            btn.classList.add('opacity-80', 'cursor-not-allowed');
            icon.classList.add('hidden');
            loader.classList.remove('hidden');
            text.innerText = "深度分析中...";

            // Gather Data
            const formData = {
                name: document.getElementById('name').value,
                grade: document.getElementById('grade').value,
                university: document.getElementById('university').value,
                major: document.getElementById('major').value,
                rank: document.getElementById('rank').value,
                englishLevel: document.getElementById('englishLevel').value,
                awards: document.getElementById('awards').value,
                research: document.getElementById('research').value,
                targetDirection: document.getElementById('targetDirection').value,
                isNewEngineering: isNewEngineering
            };

            const productName = formData.isNewEngineering ? PRODUCTS.SUNRISE.name : PRODUCTS.HARVEST.name;

            // Prepare API Request
            const systemPrompt = `
                你是一位顶尖的保研规划专家，来自“好保研 (Unipath)”团队。
                你的任务是为学生生成一份详细的、商业级别的保研规划方案。
                
                原则：
                1. 信息必须精准，来源于官方平台或双一流高校通用政策。若无法获取确切数据，请留空，严禁瞎编。
                2. 语气专业、鼓励、客观，符合麦肯锡咨询风格。
                3. 推荐产品：${productName}。
                4. 必须以JSON格式输出，不要包含Markdown代码块标记。
                
                JSON结构要求：
                {
                  "summary": "一句话综述学生的现状及核心建议",
                  "swot": {
                    "strengths": ["优势点1", "优势点2"],
                    "weaknesses": ["劣势点1", "劣势点2"],
                    "opportunities": ["机会点1", "机会点2"],
                    "threats": ["威胁点1", "威胁点2"]
                  },
                  "analysis": { "title": "背景深度诊断", "content": ["点1", "点2"...] },
                  "targetSchools": { "title": "目标院校定位", "content": ["冲刺院校：A大学 - 理由...", "稳妥院校：B大学 - 理由...", "保底院校：C大学 - 理由..."] },
                  "competitionStrategy": { "title": "核心竞赛规划", "content": ["推荐竞赛A：含金量，是否组队，准备重点...", "竞赛B..."] },
                  "researchStrategy": { "title": "科研与学术提升", "content": ["建议方向...", "如何联系导师...", "论文发表建议..."] },
                  "employment": {
                    "title": "未来就业与薪资展望",
                    "averageSalary": "预估年薪范围（如：30w-45w）",
                    "topCompanies": ["公司A", "公司B"],
                    "roles": ["岗位A", "岗位B"]
                  },
                  "timeline": { "title": "关键时间节点规划", "content": ["3-5月：...", "6-8月：...", "9-10月：..."] },
                  "productRecommendation": "${formData.isNewEngineering ? 'Sunrise' : 'Harvest'}"
                }
            `;

            const userPrompt = `
                学生信息如下：
                姓名：${formData.name}
                学校：${formData.university}
                专业：${formData.major}
                年级：${formData.grade}
                排名/绩点：${formData.rank}
                英语水平：${formData.englishLevel}
                获奖经历：${formData.awards}
                科研论文：${formData.research}
                意向方向：${formData.targetDirection}
                是否新工科：${formData.isNewEngineering ? '是' : '否'}
                
                请根据以上信息，生成详细保研规划。
            `;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: userPrompt }
                        ],
                        temperature: 0.7,
                        max_tokens: 3500,
                        response_format: { type: "json_object" }
                    })
                });

                if (!response.ok) throw new Error("API 请求失败");

                const data = await response.json();
                const content = data.choices[0].message.content;
                const plan = JSON.parse(content);

                // Save to LocalStorage
                localStorage.setItem('unipath_plan', JSON.stringify({ user: formData, plan: plan, date: new Date().toISOString() }));

                // Render Results
                renderPlan(plan);

            } catch (error) {
                console.error(error);
                alert("生成规划时发生错误，请稍后重试。\n" + error.message);
            } finally {
                // Reset Button
                btn.disabled = false;
                btn.classList.remove('opacity-80', 'cursor-not-allowed');
                icon.classList.remove('hidden');
                loader.classList.add('hidden');
                text.innerText = "立即生成规划方案";
            }
        });

        // --- Render Logic ---

        function renderPlan(plan) {
            // Layout Shift
            document.getElementById('heroSection').classList.add('hidden');
            const formContainer = document.getElementById('formContainer');
            formContainer.classList.remove('lg:col-start-3', 'lg:col-span-8');
            formContainer.classList.add('hidden', 'lg:block', 'lg:col-span-4'); // Hide on mobile after submit, show on left for desktop
            document.getElementById('resultContainer').classList.remove('hidden');

            // 1. SWOT
            const swotGrid = document.getElementById('swotGrid');
            const swotTypes = [
                { key: 'strengths', title: '优势 (Strengths)', color: 'emerald', icon: 'trending-up' },
                { key: 'weaknesses', title: '劣势 (Weaknesses)', color: 'rose', icon: 'shield-alert' },
                { key: 'opportunities', title: '机会 (Opportunities)', color: 'blue', icon: 'sparkles' },
                { key: 'threats', title: '威胁 (Threats)', color: 'amber', icon: 'target' }
            ];
            
            swotGrid.innerHTML = swotTypes.map(type => `
                <div class="bg-${type.color}-50 border border-${type.color}-100 p-5 rounded-xl">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="${type.icon}" class="w-5 h-5 text-${type.color}-500"></i>
                        <h4 class="font-bold text-${type.color}-800">${type.title}</h4>
                    </div>
                    <ul class="space-y-2">
                        ${(plan.swot[type.key] || []).map(item => `
                            <li class="text-sm text-slate-600 flex gap-2 leading-relaxed">
                                <span class="mt-1.5 w-1 h-1 rounded-full bg-slate-400 shrink-0"></span>
                                ${item}
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');

            // 2. Analysis
            document.getElementById('analysisTitle').innerText = plan.analysis.title;
            document.getElementById('analysisSummary').innerText = `"${plan.summary}"`;
            document.getElementById('analysisContent').innerHTML = (plan.analysis.content || []).map(item => `
                <div class="flex gap-3 items-start">
                    <div class="w-1.5 h-1.5 rounded-full bg-blue-400 mt-2.5 flex-shrink-0"></div>
                    <p class="text-slate-600 leading-relaxed flex-1">${item}</p>
                </div>
            `).join('');

            // 3. Pillars
            const renderPillar = (id, data) => {
                document.getElementById(id + 'Title').innerText = data.title;
                document.getElementById(id + 'Content').innerHTML = (data.content || []).map((item, idx) => `
                    <div class="flex gap-3 items-start">
                         <div class="w-8 h-8 rounded-full bg-slate-50 border border-slate-100 flex items-center justify-center text-slate-500 font-bold text-xs shrink-0">${idx + 1}</div>
                         <p class="text-slate-700 mt-1">${item}</p>
                    </div>
                `).join('');
            };
            renderPillar('schools', plan.targetSchools);
            renderPillar('comps', plan.competitionStrategy);
            renderPillar('research', plan.researchStrategy);

            // 4. Career
            const emp = plan.employment;
            document.getElementById('careerSection').innerHTML = `
                <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                <div class="relative z-10 flex flex-col md:flex-row gap-8 items-start md:items-center justify-between">
                    <div>
                        <div class="flex items-center gap-3 mb-4 text-slate-300">
                            <i data-lucide="briefcase" class="w-5 h-5"></i>
                            <h3 class="font-bold uppercase tracking-wider text-sm">${emp.title}</h3>
                        </div>
                        <div class="flex items-baseline gap-2 mb-4">
                            <span class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-cyan-300">
                                ${emp.averageSalary}
                            </span>
                            <span class="text-slate-400">/ 年 (预估)</span>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            ${(emp.roles || []).map(role => `<span class="px-3 py-1 bg-white/10 rounded-full text-xs font-medium border border-white/10">${role}</span>`).join('')}
                        </div>
                    </div>
                    <div class="w-full md:w-auto bg-white/5 p-6 rounded-xl border border-white/10 backdrop-blur-sm min-w-[240px]">
                        <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
                            <i data-lucide="building-2" class="w-4 h-4"></i>重点就业去向
                        </h4>
                        <ul class="space-y-2">
                            ${(emp.topCompanies || []).map(co => `
                                <li class="flex items-center justify-between text-sm">
                                    <span class="font-medium">${co}</span>
                                    <i data-lucide="arrow-right" class="w-3 h-3 text-slate-500"></i>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;

            // 5. Timeline
            document.getElementById('timelineTitle').innerText = plan.timeline.title;
            document.getElementById('timelineContent').innerHTML = 
                `<div class="absolute left-[19px] top-4 bottom-4 w-0.5 bg-slate-100"></div>` + 
                (plan.timeline.content || []).map(item => `
                <div class="flex gap-6 relative pb-6 last:pb-0 group">
                    <div class="relative z-10 flex-shrink-0">
                        <div class="w-10 h-10 rounded-full bg-white border-4 border-slate-50 shadow-sm flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <div class="w-3 h-3 rounded-full bg-unipath-500"></div>
                        </div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 w-full group-hover:border-unipath-200 group-hover:shadow-md transition-all">
                        <p class="text-slate-700 font-medium">${item}</p>
                    </div>
                </div>
            `).join('');

            // 6. Product
            const recKey = plan.productRecommendation === 'Sunrise' ? 'SUNRISE' : 'HARVEST';
            const prod = PRODUCTS[recKey];
            const pCard = document.getElementById('productCard');
            pCard.className = `rounded-2xl shadow-xl p-8 text-white bg-gradient-to-br ${prod.color} relative overflow-hidden group`;
            pCard.innerHTML = `
                <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:translate-x-1/3 transition-transform duration-700"></div>
                <div class="absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="bg-white/20 backdrop-blur-md p-3 rounded-2xl shadow-inner">
                            <i data-lucide="${recKey === 'SUNRISE' ? 'zap' : 'graduation-cap'}" class="w-8 h-8 text-white"></i>
                        </div>
                        <div>
                            <div class="text-xs font-bold opacity-80 uppercase tracking-widest mb-1">Unipath Selection</div>
                            <h3 class="text-3xl font-bold tracking-tight">${prod.name}</h3>
                        </div>
                    </div>
                    <p class="text-white/90 text-lg mb-6 max-w-2xl font-medium leading-relaxed">${prod.description}</p>
                    <div class="flex gap-3 flex-wrap">
                        ${['官方数据支持', '名校导师1v1', '全流程陪伴', '结果保障'].map(t => `<span class="px-4 py-1.5 bg-white/20 backdrop-blur-md border border-white/10 rounded-full text-sm font-medium">${t}</span>`).join('')}
                    </div>
                </div>
            `;

            // Refresh Icons
            lucide.createIcons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>